This tutorial explains how to migrate the MSDK package and UXSDK open-source framework from the MSDK V5 Sample to a user's empty project.

## Suggested Versions

* Android Studio：`Android Studio Giraffe 2024.1.1`
* Java Runtime：`17` or `11`
* Kotlin：`1.8.10`
* Gradle：`7.6.2`
* Android Gradle Plugin：`7.4.2`
* minSdkVersion：`23`
* targetSdkVersion：`34`
> * If using a non-recommended version, please adapt the entire integration process according to the actual version. Android Studio Giraffe 2022.3.1 comes with Java Runtime 17 integrated by default, which can generally be used directly without any additional configuration.
> * Kotlin Android Extensions is deprecated, which means that using Kotlin synthetics for view binding is no longer supported. If your app uses Kotlin synthetics for view binding, use this guide to migrate to Jetpack view binding: <a href="https://developer.android.com/topic/libraries/view-binding/migration">Migrate from Kotlin synthetics to Jetpack view binding</a>.

## Obtain a Empty Project Integrated with MSDK

If you prefer not to manually configure your project following the tutorial below, you can download the [[empty project with MSDK integrated]](https://terra-1-g.djicdn.com/fee90c2e03e04e8da67ea6f56365fc76/SDK%20%E6%96%87%E6%A1%A3/MSDK/5.11.0/SDKSample.zip)，and follow this document to start the final configuration and debugging from the <a href="#test">Testing and Debugging</a> section.

## Create a New Empty Project

1. On the Android Studio launch page, select New Project > Phone and Tablet > Empty Views Activity.
2. Complete the configuration according to the image below.
   * Name：`MSDKSample`
   * Package name：`com.example.msdksample`
   * Minimum SDK：`24` or higher
   * Build configuration language：`Groovy DSL (build.gradle)`

<img src = "https://terra-1-g.djicdn.com/71a7d383e71a4fb8887a310eb746b47f/msdk/Documentation/5.8/MSDKproj.jpeg" alt = "empty project">


## Edit the build.gradle (Project) File

Go to <code>build.gradle (Project)</code> under <code>Gradle Scripts</code>. Replace all the content with the following code segment, which provides the correct reference library.

```java
buildscript {
    repositories {
        google()
        jcenter()
        mavenCentral()
    }
    dependencies {
		// Suggested Android Gradle Plugin Version
        classpath "com.android.tools.build:gradle:7.4.2"

		//Suggested Kotlin version
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$KOTLIN_VERSION" 
	    // ... (remaining code)
    }
}

allprojects {
    repositories {
        google()
        jcenter()
        mavenCentral()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
```


## Edit the build.gradle (Module: app) File

1. In the <code>android</code> section, configure <code>sdkversion</code> and <code>ndk</code> in <code>defaultConfig</code>, and set up <code>packagingOptions</code>.

Note the versions：
* <code>minSdkVersion</code> needs to be upgraded to a minimum version number of 23.
* MSDK only supports arm64-v8a architecture.

```java
apply plugin: 'com.android.application'
apply plugin: 'kotlin-android'
apply plugin: 'kotlin-kapt'
 
android {
    namespace 'com.example.msdksample'
    compileSdkVersion 34 // MSDK supported version
 
    defaultConfig {
        applicationId "com.example.msdksample"
        minSdk 24
        targetSdk 34
        versionCode 1
        versionName "1.0"
 
        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
 
        ndk {
            abiFilters 'arm64-v8a' // MSDK only supports arm64-v8a architecture
        }
 
        // MSDK related so library
        packagingOptions {
            pickFirst 'lib/arm64-v8a/libc++_shared.so'
            pickFirst 'lib/armeabi-v7a/libc++_shared.so'
        }
 
        // MSDK related so library
        packagingOptions {
            doNotStrip "*/*/libconstants.so"
            doNotStrip "*/*/libdji_innertools.so"
            doNotStrip "*/*/libdjibase.so"
            doNotStrip "*/*/libDJICSDKCommon.so"
            doNotStrip "*/*/libDJIFlySafeCore-CSDK.so"
            doNotStrip "*/*/libdjifs_jni-CSDK.so"
            doNotStrip "*/*/libDJIRegister.so"
            doNotStrip "*/*/libdjisdk_jni.so"
            doNotStrip "*/*/libDJIUpgradeCore.so"
            doNotStrip "*/*/libDJIUpgradeJNI.so"
            doNotStrip "*/*/libDJIWaypointV2Core-CSDK.so"
            doNotStrip "*/*/libdjiwpv2-CSDK.so"
            doNotStrip "*/*/libFlightRecordEngine.so"
            doNotStrip "*/*/libvideo-framing.so"
            doNotStrip "*/*/libwaes.so"
            doNotStrip "*/*/libagora-rtsa-sdk.so"
            doNotStrip "*/*/libc++.so"
            doNotStrip "*/*/libc++_shared.so"
            doNotStrip "*/*/libmrtc_28181.so"
            doNotStrip "*/*/libmrtc_agora.so"
            doNotStrip "*/*/libmrtc_core.so"
            doNotStrip "*/*/libmrtc_core_jni.so"
            doNotStrip "*/*/libmrtc_data.so"
            doNotStrip "*/*/libmrtc_log.so"
            doNotStrip "*/*/libmrtc_onvif.so"
            doNotStrip "*/*/libmrtc_rtmp.so"
            doNotStrip "*/*/libmrtc_rtsp.so"
        }
```


2. In <code>dependencies</code>, configure the SDK package and modify the other referenced libraries to their corresponding versions.

>**Note:** {$SDK_VERSION}  is the latest version of MSDK. To replace the version, refer to <a href="#1">Edit the gradle.properties File</a>.

```java
dependencies {
            implementation project(":android-sdk-v5-uxsdk")
 
            implementation "com.dji:dji-sdk-v5-aircraft:$SDK_VERSION"
            compileOnly "com.dji:dji-sdk-v5-aircraft-provided:$SDK_VERSION"
 
            implementation 'androidx.appcompat:appcompat:1.6.1'
            implementation 'com.google.android.material:material:1.8.0'
            testImplementation 'junit:junit:4.13.2'
            androidTestImplementation 'androidx.test.ext:junit:1.1.5'
            androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.1'
        }
```


## Edit the AndroidManifest.xml File
Refer to the [AndroidManifest.xml](https://github.com/dji-sdk/Mobile-SDK-Android-V5/blob/dev-sdk-main/SampleCode-V5/android-sdk-v5-sample/src/main/AndroidManifest.xml) file in the MSDK V5 Sample for the following modifications. Pay attention to the positions between code segments and tags.

1. Add the basic permissions required by the SDK. Before that, make sure you understand [which Android system permissions are required by MSDK V5](https://sdk-forum.dji.net/hc/en-us/articles/11614807262489-What-kind-of-Android-system-privileges-are-MSDK-V5-required) and [permission definitions](https://developer.android.com/reference/android/Manifest.permission).

```java
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
```

2. Add USB-related permissions within the <code>manifest</code> tag for connecting to the remote controller.

```java
<uses-feature
    android:name="android.hardware.usb.host"
    android:required="false"/>
<uses-feature
    android:name="android.hardware.usb.accessory"
    android:required="true"/>
```

3. Add the declaration of the <code>MyApplication</code> file within the <code>application</code> tag, which is required for loading at startup.

```java
  <application
    android:name=".MyApplication"
    //... (remaining code)
```

4. Modify the <code>application</code> tag attributes with the following code segment to configure the app key.

Visit the [developer website](https://developer.dji.com/user) to apply for an app key. When applying for the app key, the "Package Name" should be <code>com.example.msdksample</code>.
Add the following code to the <code>application</code> item, and keep <code>android:name</code> unchanged and replace your app key in <code>android:value</code> with the app key you applied for.

<div>
<div align=center>
<img src="https://terra-1-g.djicdn.com/71a7d383e71a4fb8887a310eb746b47f/msdk/Documentation/5.8/msdksample.png" style="width:400px"/>
</div>
</div>

```java
<meta-data
    android:name="com.dji.sdk.API_KEY"
    android:value="your app key"/>
```


5. Configure USB accessory notification within the <code>activity</code> tag.

```java
<intent-filter>
    <action android:name="android.intent.action.MAIN" />
    <action android:name="android.hardware.usb.action.USB_ACCESSORY_ATTACHED" />
    <category android:name="android.intent.category.LAUNCHER" />
</intent-filter>

<meta-data
    android:name="android.hardware.usb.action.USB_ACCESSORY_ATTACHED"
    android:resource="@xml/accessory_filter" />
```

## Create a MyApplication.kt File

1. Create a new <code>MyApplication.kt</code> file under the <code>com.example.msdksample</code> folder, at the same level as <code>MainActivity.kt</code>.
2. Write the following code in the file, which is used to import the SDK decryption and protection package.

> **Note:** Pay attention to the consistency of the package name: com.example.msdksample

```kotlin
package com.example.msdksample

import android.app.Application
import android.content.Context
import android.util.Log
import dji.v5.common.error.IDJIError
import dji.v5.common.register.DJISDKInitEvent
import dji.v5.manager.SDKManager
import dji.v5.manager.interfaces.SDKManagerCallback

class MyApplication : Application() {

	private val TAG = this::class.simpleName

    override fun attachBaseContext(base: Context?) {
        super.attachBaseContext(base)
        com.cySdkyc.clx.Helper.install(this)
    }

    override fun onCreate() {
        super.onCreate()
        SDKManager.getInstance().init(this,object:SDKManagerCallback{
            override fun onInitProcess(event: DJISDKInitEvent?, totalProcess: Int) {
                Log.i(TAG, "onInitProcess: ")
                if (event == DJISDKInitEvent.INITIALIZE_COMPLETE) {
                    SDKManager.getInstance().registerApp()
                }
            }
            override fun onRegisterSuccess() {
                Log.i(TAG, "onRegisterSuccess: ")
            }
            override fun onRegisterFailure(error: IDJIError?) {
                Log.i(TAG, "onRegisterFailure: ")
            }
            override fun onProductConnect(productId: Int) {
                Log.i(TAG, "onProductConnect: ")
            }
            override fun onProductDisconnect(productId: Int) {
                Log.i(TAG, "onProductDisconnect: ")
            }
            override fun onProductChanged(productId: Int)
            {
                Log.i(TAG, "onProductChanged: ")
            }
            override fun onDatabaseDownloadProgress(current: Long, total: Long) {
                Log.i(TAG, "onDatabaseDownloadProgress: ${current/total}")
            }
        })
    }
}
```

## Edit the MainActivity.kt File

1. Delete the <code>ui</code> folder in the same directory as <code>MainActivity.kt</code>.
2. Replace the content of the <code>MainActivity.kt</code> file with the following code.

> **Note:** Pay attention to the consistency of the package name: com.example.msdksample

```java
package com.example.msdksample
 
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
 
class MainActivity : AppCompatActivity() {
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
    }
}
```

## Create a activity_main.xml File

1. In the app > src > main > res directory, create a new <code>layout</code> folder and create a new <code>activity_main.xml</code> file in the folder.
2. Replace the content of the <code>activity_main.xml</code> file with the following code.

```java
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout xmlns:android="http://schemas.android.com/apk/res/android"
xmlns:app="http://schemas.android.com/apk/res-auto"
xmlns:tools="http://schemas.android.com/tools"
android:layout_width="match_parent"
android:layout_height="match_parent"
tools:context=".MainActivity">

<TextView
android:layout_width="wrap_content"
android:layout_height="wrap_content"
android:text="Hello World!"
app:layout_constraintBottom_toBottomOf="parent"
app:layout_constraintEnd_toEndOf="parent"
app:layout_constraintStart_toStartOf="parent"
app:layout_constraintTop_toTopOf="parent" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

3. In the app > src > main > res > values directory, replace the content of the <code>themes.xml</code> file with the following code.

```java
<resources xmlns:tools="http://schemas.android.com/tools">
    <!-- Base application theme. -->
    <style name="Base.Theme.MSDKSample" parent="Theme.Material3.DayNight.NoActionBar">
        <!-- Customize your light theme here. -->
        <!-- <item name="colorPrimary">@color/my_light_primary</item> -->
    </style>

    <style name="Theme.MSDKSample" parent="Base.Theme.MSDKSample" />
</resources>
```

## Import UXSDK Open-Source Framework

1. Copy the entire UXSDK project ([android-sdk-v5-uxsdk](https://github.com/dji-sdk/Mobile-SDK-Android-V5/tree/dev-sdk-main/SampleCode-V5)) to the root directory of the <code>MyApplication</code> project path, at the same level as the <code>app</code> folder.

2. Edit the <code>gradle.properties</code> file, adding the following code to configure the correct version.

```java
#buildconfig
ANDROID_MIN_SDK_VERSION=23 //DJI MSDK supported version
ANDROID_TARGET_SDK_VERSION=34 //DJI MSDK supported version
ANDROID_COMPILE_SDK_VERSION=34 //DJI MSDK supported version
```

3. Create a new <code>dependencies.gradle</code> file in the same directory as <code>build.gradle (project)</code> and import the contents of [dependencies.gradle](https://github.com/dji-sdk/Mobile-SDK-Android-V5/blob/dev-sdk-main/SampleCode-V5/android-sdk-v5-as/dependencies.gradle) into it.
Add the following code segment at the beginning of the <code>build.gradle (Project)</code> file.

```java
apply from:rootProject.file('dependencies.gradle')
```

4. Adjust the content of the <code>settings.gradle</code> file as the following code segment.

```java
rootProject.name = "My Application"
include ':app'
include ':android-sdk-v5-uxsdk'
```
5. In the folder directory app > res > values > strings.xml, edit the "name" attribute of this string in the file. The meaning of this code is the name of your app.

```java
<string name="your_app_name">My Application</string>
```

In actual development, you can edit the id and value of this code above. Just keep the id name consistent with the corresponding id name in the <code>AndroidManifest.xml</code> file in the project. In this example, the application's id name is "your_app_name".

```java
<application
        android:label="@string/your_app_name">
```

## <font id=1>Edit the gradle.properties File</font>

1. Use the <code>KOTLIN_VERSION</code> and <code>SDK_VERSION</code> sections in the <code>gradle.properties</code> file to change the Kotlin version and MSDK version. For example, you can add the following two lines of code after the <code>#buildconfig</code> section to use Kotlin version 1.8.10 and MSDK version 5.10.0.

```java
KOTLIN_VERSION=1.8.10
SDK_VERSION=5.10.0
```

> **Note:** To avoid compatibility problem in the compilation process, change the configuration sections in gradle.properties as follows.
>
> ```java
> android.useAndroidX=true
> android.enableJetifier=true
> android.nonTransitiveRClass=false
> ```

Congrats! By now, you have completed the configuration of the empty project.

## <span id = "test">Testing and Debugging</span>

1. Select "Sync Now" to synchronize the project.

2. Click on the hammer icon on the interface, build your project, and do necessary debugging.

> Due to the limitations of the empty project, occasional errors might occur during the build process because the <code>UXSDK</code> package content can not be properly referenced. This does not affect the normal function of the project, and you should continue to connect your device to test the app. If you find a solution to such errors during the integration process, feel free to provide feedback via documentation. Possible errors may include:
```java
Execution failed for task ':android-sdk-v5-uxsdk:kaptGenerateStubsDebugKotlin'.
```

3. Connect the DJI remote controller with screen or your mobile device, enable the corresponding developer options, and once your device is displayed on the top right corner of Android Studio, select the 'run'app' triangle icon to test whether the project is good to run.
