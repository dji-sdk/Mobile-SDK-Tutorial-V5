This tutorial explains how to migrate the MSDK package and UXSDK open-source framework from the MSDK V5 Sample to a user's empty project.

> **Note:**
>
> * The Android Studio version used in this guide is Android Studio Chipmunk 2021.2.1 Patch 1. The compatible MSDK is the latest version.
> * **Android Gradle Plugin version is 4.2.2**.
> * The latest supported Android version is Android 13 (API level 33), recommended Kotlin version is 1.6.10, recommended Gradle version is 6.9.
> * Configure the Gradle version in File > Project Structure, and configure Android and Kotlin versions in configuration files covered in this tutorial. Adapt the entire integration process according to your choices if using non-recommended versions.

## Obtain a Empty Project Integrated with MSDK

If you prefer not to manually configure your project following the tutorial below, you can download the [[empty project with MSDK integrated]](https://terra-1-g.djicdn.com/71a7d383e71a4fb8887a310eb746b47f/msdk/MyApplication.zip)，and follow this document to start the final configuration and debugging from the <a href="#test">Testing and Debugging</a> section.

## Create a New Empty Project

1. On the Android Studio launch page, select New Project > Phone and Tablet > Empty Activity.
2. Complete the configuration according to the image below.
   * Name：`My Application`
   * Package name：`com.example.myapplication`
   * Minimum SDK：`23`

<img src = "https://terra-1-g.djicdn.com/71a7d383e71a4fb8887a310eb746b47f/msdk/Documentation/v5.3/empty%20project%20config.jpeg" alt = "empty project">


## Edit the build.gradle (Project) File

Go to <code>build.gradle (Project)</code> under <code>Gradle Scripts</code>. Replace all the content with the following code segment，which provides the correct reference library.

```java
buildscript {
    ext.kotlin_version = '1.6.10' // DJI MSDK recommended version
    repositories {
        google()
        jcenter()
        mavenCentral()
    }
    dependencies {
        classpath "org.jetbrains.kotlin:kotlin-gradle-plugin:$kotlin_version"
        classpath "com.android.tools.build:gradle:4.2.2" //DJI MSDK recommended version
        // ... (remaining code)
    }
}

allprojects {
    repositories {
        google()
        jcenter()
        mavenCentral()
    }
}

task clean(type: Delete) {
    delete rootProject.buildDir
}
```


## Edit the build.gradle (Module) File

1. In the <code>android</code> section, configure <code>sdkversion</code> and <code>ndk</code> in <code>defaultConfig</code>, and set up <code>packagingOptions</code>.

Note the versions：
* <code>compileSdkVersion</code> and <code>targetSdkVersion</code> are set to 29.
* <code>minSdkVersion</code> needs to be upgraded to a minimum version number of 23.

```java
android {
    compileSdk 29 //DJI MSDK supported version

    defaultConfig {
        applicationId "com.example.myapplication"
        minSdk 23 //DJI MSDK supported version
        targetSdk 29 //DJI MSDK supported version
        versionCode 1
        versionName "1.0"

        testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"

        ndk {
            abiFilters 'arm64-v8a'
        }
    }

        packagingOptions {
            pickFirst 'lib/arm64-v8a/libc++_shared.so'
            pickFirst 'lib/armeabi-v7a/libc++_shared.so'
        }

        packagingOptions {
            doNotStrip "*/*/libconstants.so"
            doNotStrip "*/*/libdji_innertools.so"
            doNotStrip "*/*/libdjibase.so"
            doNotStrip "*/*/libDJICSDKCommon.so"
            doNotStrip "*/*/libDJIFlySafeCore-CSDK.so"
            doNotStrip "*/*/libdjifs_jni-CSDK.so"
            doNotStrip "*/*/libDJIRegister.so"
            doNotStrip "*/*/libdjisdk_jni.so"
            doNotStrip "*/*/libDJIUpgradeCore.so"
            doNotStrip "*/*/libDJIUpgradeJNI.so"
            doNotStrip "*/*/libDJIWaypointV2Core-CSDK.so"
            doNotStrip "*/*/libdjiwpv2-CSDK.so"
            doNotStrip "*/*/libffmpeg.so"
            doNotStrip "*/*/libFlightRecordEngine.so"
            doNotStrip "*/*/libvideo-framing.so"
            doNotStrip "*/*/libwaes.so"
            doNotStrip "*/*/libagora-rtsa-sdk.so"
            doNotStrip "*/*/libc++.so"
            doNotStrip "*/*/libc++_shared.so"
            doNotStrip "*/*/libmrtc_28181.so"
            doNotStrip "*/*/libmrtc_agora.so"
            doNotStrip "*/*/libmrtc_core.so"
            doNotStrip "*/*/libmrtc_core_jni.so"
            doNotStrip "*/*/libmrtc_data.so"
            doNotStrip "*/*/libmrtc_log.so"
            doNotStrip "*/*/libmrtc_onvif.so"
            doNotStrip "*/*/libmrtc_rtmp.so"
            doNotStrip "*/*/libmrtc_rtsp.so"
        }

        //... (remaining code)
```


2. In <code>dependencies</code>, configure the SDK package and modify the other referenced libraries to their corresponding versions.

**Note: {sdkversion} is the latest version of MSDK. Please replace by yourself. For example, replace the {sdkversion} to 5.3.0**

```java
dependencies {
    implementation 'com.dji:dji-sdk-v5-aircraft:{sdkversion}'
    compileOnly 'com.dji:dji-sdk-v5-aircraft-provided:{sdkversion}'
    runtimeOnly 'com.dji:dji-sdk-v5-networkImp:{sdkversion}'
    
    //... (remaining code)
}
```

3. Edit the obfuscation file. Copy the contents of the [sample.pro file](https://github.com/dji-sdk/Mobile-SDK-Android-V5/blob/dev-sdk-main/SampleCode-V5/android-sdk-v5-as/proguard-relative/sample.pro) into your project's <code>proguard-rules.pro</code> file.


## Edit the AndroidManifest.xml file
Refer to the [AndroidManifest.xml](https://github.com/dji-sdk/Mobile-SDK-Android-V5/blob/dev-sdk-main/SampleCode-V5/android-sdk-v5-sample/app-aircraft/src/main/AndroidManifest.xml) file in the MSDK V5 Sample for the following modifications. Pay attention to the positions between code segments and tags.

1. Add the basic permissions required by the SDK. Before that, make sure you understand [which Android system permissions are required by MSDK V5](https://djisdksupport.zendesk.com/knowledge/articles/11614807262489/zh-cn?brand_id=1017958) and [permission definations](https://developer.android.com/reference/android/Manifest.permission).

```java
    <uses-permission android:name="android.permission.WRITE_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.READ_EXTERNAL_STORAGE" />
    <uses-permission android:name="android.permission.RECORD_AUDIO" />
```

2. Add USB-related permissions within the <code>manifest</code> tag for connecting to the remote controller.

```java
<uses-feature
    android:name="android.hardware.usb.host"
    android:required="false"/>
<uses-feature
    android:name="android.hardware.usb.accessory"
    android:required="true"/>
```

3. Add the declaration of the <code>MyApplication</code> file within the <code>application</code> tag, which is required for loading at startup.

```java
  <application
    android:name=".MyApplication"
    //... (remaining code)
```

4. Modify the <code>application</code> tag attributes with the following code segment to configure the app key.

Visit the [developer website](https://developer.dji.com/user) to apply for an app key. When applying for the app key, the "Package Name" should be <code>com.example.myapplication</code>.
Add the following code to the <code>application</code> item, and keep <code>android:name</code> unchanged and replace your app key in <code>android:value</code> with the app key you applied for.

![](https://terra-1-g.djicdn.com/71a7d383e71a4fb8887a310eb746b47f/msdk/Documentation/V5.1/appkey.png)

```java
<meta-data
    android:name="com.dji.sdk.API_KEY"
    android:value="your app key"/>
```


5. Configure USB accessory notification within the <code>activity</code> tag.

```java
<intent-filter>
    <action android:name="android.intent.action.MAIN" />
    <action android:name="android.hardware.usb.action.USB_ACCESSORY_ATTACHED" />
    <category android:name="android.intent.category.LAUNCHER" />
</intent-filter>

<meta-data
    android:name="android.hardware.usb.action.USB_ACCESSORY_ATTACHED"
    android:resource="@xml/accessory_filter" />
```

## Create a MyApplication.kt File

1. Create a new <code>MyApplication.kt</code> file under the <code>com.example.myapplication</code> folder, at the same level as <code>MainActivity.kt</code>.
2. Write the following code in the file, which is used to import the SDK decryption and protection package.

> **Note:** Pay attention to the consistency of the package name: com.example.myapplication

```kotlin
package com.example.myapplication

import android.app.Application
import android.content.Context

class MyApplication : Application() {
    override fun attachBaseContext(base: Context?) {
        super.attachBaseContext(base)
        com.secneo.sdk.Helper.install(this)
    }
}
```

## Edit the MainActivity.kt file

Replace the content of <code>MainActivity.kt</code> with the following code segment.

```kotlin
package com.example.myapplication
import androidx.appcompat.app.AppCompatActivity
import android.os.Bundle
import android.util.Log
import dji.v5.common.error.IDJIError
import dji.v5.common.register.DJISDKInitEvent
import dji.v5.manager.SDKManager
import dji.v5.manager.interfaces.SDKManagerCallback

class MainActivity : AppCompatActivity() {
    private val TAG = this::class.simpleName

    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        setContentView(R.layout.activity_main)
        registerApp()
    }
    private fun registerApp()
    {
        SDKManager.getInstance().init(this,object:SDKManagerCallback{
            override fun onInitProcess(event: DJISDKInitEvent?, totalProcess: Int) {
                Log.i(TAG, "onInitProcess: ")
                if (event == DJISDKInitEvent.INITIALIZE_COMPLETE) {
                    SDKManager.getInstance().registerApp()
                }
            }
            override fun onRegisterSuccess() {
                Log.i(TAG, "onRegisterSuccess: ")
            }
            override fun onRegisterFailure(error: IDJIError?) {
                Log.i(TAG, "onRegisterFailure: ")
            }
            override fun onProductConnect(productId: Int)
            {
                Log.i(TAG, "onProductConnect: ")
            }
            override fun onProductDisconnect(productId: Int) {
                Log.i(TAG, "onProductDisconnect: ")
            }
            override fun onProductChanged(productId: Int)
            {
                Log.i(TAG, "onProductChanged: ")
            }
            override fun
                    onDatabaseDownloadProgress(current: Long, total: Long) {
                Log.i(TAG, "onDatabaseDownloadProgress: ${current/total}")
            }
        })
    }
}
```

## Import UXSDK Open-Source Framework

1. Copy the entire UXSDK project (android-sdk-v5-uxsdk) to the root directory of the <code>MyApplication</code> project path, at the same level as the <code>app</code> folder.

2. Edit the <code>gradle.properties</code> file, adding the following code to configure the correct version.

```java
#buildconfig
ANDROID_MIN_SDK_VERSION=23 //DJI MSDK supported version
ANDROID_TARGET_SDK_VERSION=29 //DJI MSDK supported version
ANDROID_COMPILE_SDK_VERSION=29 //DJI MSDK supported version
KOTLIN_VERSION='1.6.10' //DJI MSDK recommended version
```

3. Create a new <code>dependencies.gradle</code> file in the same directory as <code>build.gradle (project)</code> and import the contents of [dependencies.gradle](https://github.com/dji-sdk/Mobile-SDK-Android-V5/blob/dev-sdk-main/SampleCode-V5/android-sdk-v5-as/dependencies.gradle) into it.
Add the following code segment at the beginning of the <code>build.gradle (Project)</code> file.

```java
apply from:rootProject.file('dependencies.gradle')
```

4. Adjust the content of the <code>settings.gradle</code> file as the following code segment.

```java
rootProject.name = "My Application"
include ':app'
include ':android-sdk-v5-uxsdk'
```
5. In the folder directory app > res > values > strings.xml, edit the "name" attribute of this string in the file. The meaning of this code is the name of your app.

```java
<string name="your_app_name">My Application</string>
```

In actual development, you can edit the id and value of this code above. Just keep the id name consistent with the corresponding id name in the <code>AndroidManifest.xml</code> file in the project. In this example, the application's id name is "your_app_name".

```java
<application
        android:label="@string/your_app_name">
```

Congrats! By now, you have completed the configuration of the empty project.

## <span id = "test">Testing and Debugging</span>

1. Select "Sync Now" to synchronize the project.

2. Click on the hammer icon on the interface, build your project, and do necessary debugging.

> Due to the limitations of the empty project, occasional errors might occur during the build process because the <code>UXSDK</code> package content can not be properly referenced. This does not affect the normal function of the project, and you should continue to connect your device to test the app. If you find a solution to such errors during the integration process, feel free to provide feedback via documentation. Possible errors may include:
```java
Execution failed for task ':android-sdk-v5-uxsdk:kaptGenerateStubsDebugKotlin'.
```

3. Connect the DJI remote controller with screen or your mobile device, enable the corresponding developer options, and once your device is displayed on the top right corner of Android Studio, select the 'run'app' triangle icon to test whether the project is good to run.
