## 介绍

固定在设备上的相机将记录随设备运动的图像。当相机或传感器的载体（例如飞机）移动时，云台可以让相机或传感器保持水平。云台具有三个控制垂直轴旋转的电机。云台将陀螺仪信息反馈给电机控制器，用于补偿载体旋转运动时的水平偏差。

除了稳定之外，这三个马达还可以用来控制相机指向的方向，并可以用来平滑地跟踪目标或平移镜头。 三个旋转轴称为俯仰，横滚和偏航，而云台方向称为其姿态。这些轴的说明可以在 [飞行控制概念](https://developer.dji.com/doc/mobile-sdk-tutorial/cn/basic-introduction/basic-concepts/flight-control.html)中找到。

云台每个轴的旋转具有机械限位。 当传感器安装在云台上时，需要连接许多数据和控制线。 这些控制线通常捆绑在电缆组件或柔性电路中，这两者都会限制云台的旋转。 此外，云台还将限制旋转以避免相机看到起落架。

Mobile SDK提供获取云台能力，状态和控制的接口。

![](https://terra-1-g.djicdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/e4061ea6-eb2a-424a-a0cf-1c30d4d835ed.png)

## 云台能力

云台的能力在各个产品系列中差异很大。 因此，Mobile SDK提供了在运行时获取云台能力的接口。 云台能力包括：

* 哪些轴是可控制的
* 各轴的机械限位
* 对手动控制的响应速度是否可自定义
* [SmoothTrack](#smoothTrack) 功能是否可用和自定义
* [End point](#endPoint) 设置是否可用和可自定义
* [Motor control](#motor-control) 设置是否可用和可自定义

## 工作模式

云台有几种工作模式，这些模式定义了云台如何跟随设备的运动，以及有多少个轴可用于控制。

- **FPV（第一人称视角）模式**：仅可控制俯仰，偏航和横滚将固定。
- **偏航跟随模式**：俯仰和横滚是可控的。 偏航将跟随设备朝向。
- **自由模式**：俯仰，横滚和偏航都是可控制的，这意味着云台可以独立于设备的偏航而运动。 在此模式下，即使设备偏航发生变化，相机的朝向不会发生变化。

## 云台状态

云台组件可将状态信息以高达10 Hz的速度推送到移动设备。 状态信息包括当前姿态，校准状态，校准偏移，工作模式以及云台是否处于机械限位。

## 移动云台

### 自定义控制

使用Mobile SDK，可以通过两种方式移动云台：

* 在一定时间内移动到某个角度
* 按照一定速度移动一个方向

当使用角度模式旋转云台的俯仰，横滚和偏航时，云台的旋转角度可以定义为**绝对**（相对于设备航向）或**相对**（相对于其当前角度） ）。

当使用速度旋转云台的俯仰，横滚和偏航时，方向可以设置为顺时针或逆时针。

### 重置

可以重置云台，并将其俯仰，横滚和偏航设置为0度。 重置位置是水平指向，并且与设备前进方向相同。

对于X3，X5和X5R，俯仰不会设置为0度，而是保持当前俯仰角度。

## 校准

云台将在上电时自动校准，但也可以通过SDK API进行校准。 当校准云台时，用户将看到相机围绕三个轴旋转几秒钟。

在校准过程中，设备应保持静止（不能飞行或被固定）并放置在水平面上。 对于具有可调节负载的云台，在进行校准之前，应让负载处于[水平状态](#balancing)。

### 微调云台横滚

可以用自定义偏移量微调云台横滚。 自定义偏移的范围是[-10，10]度。 如果偏移量为负，云台将沿逆时针方向微调指定的度数。

### 平衡

可以支持自定义负载的云台（如Ronin MX）要求负载的重心位于云台的旋转中心。 调整负载位置以实现此目的的过程称为平衡。

MSDK提供平衡API启动平衡测试并返回平衡结果。 在开始进行云台校准之前，需要对负载进行适当的平衡。

## Osmo和Ronin-MX功能

Osmo和Ronin-MX可以在手持配置中使用，并允许对云台的移动进行定制。

### SmoothTrack

SmoothTrack描述了云台如何以及何时补偿其安装座上的偏航和俯仰运动（例如Osmo手柄）。SmoothTrack速度，加速度和死区可定制。下面的动画显示了平衡杆缓慢补偿偏航旋转的云台。 SmoothTrack不支持滚动，因为通常首选水平图像。

 ![osmoSmoothTrack](https://terra-1-g.djicdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/411c115a-47ef-4d14-9c62-f0dbb553cd89.gif)

* **SmoothTrack Speed**是云台向安装座旋转的**跟随**速度。更快的速度将对跟踪快速移动的对象做出更快的响应，但也会产生不太流畅的视频。

* **SmoothTrack Acceleration**加速度决定云台补偿手柄运动的跟手程度。加速大将对较小的手柄旋转有更好的响应。

* **SmoothTrack Deadband**死区确定云台开始补偿之前所需的旋转量。 更大的死区要求在云台开始移动之前需要进行更多的移动。死区较大对于相机大幅度移动但是对象相对静止时很有用。 如果需要更快的响应来进行移动，则需要较小的死区。

### 物理控制器

使用OSMO上的操纵杆和Ronin-MX上的遥控器，可以在俯仰轴和偏航轴上手动移动云台。 操纵杆和遥控器是设备手柄上的物理控制器。

可以使用速度，平滑度和死区设置来定制云台对物理控制器的响应。 下面的动画显示了跟随Osmo操纵杆运动的云台。

 ![osmoJoystick](https://terra-1-g.djicdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/a963c7e3-65a1-4927-af20-d7d120656248.gif)

* **Controller Speed**控制器速度：当用物理控制器控制时，云台的移动速度。 当控制器处于完全偏转（位移）状态时，云台将以控制器的速度移动。

* **Controller Smoothing**：控制器平滑度：当物理控制器的偏斜减小时，控制云台的减速。

* **Controller Deadband** 控制器死区：确定在云台开始移动之前物理控制器所需的偏转量。

### 自拍

Osmo云台可以通过快速按下触发三次快速调整相机进入自拍位置。相机的偏航将旋转180度（面向手柄的背面），并且俯仰轴将被调整为水平。

两次按下触发器将把相机的偏航轴调整为0度，并将俯仰轴调整为水平。

Mobile SDK支持在自拍和偏航轴为0度之间切换的API。
    
### 方向锁定

按住触发器将相机锁定在当前方向。 手柄的任何俯仰，横摇和偏航旋转都将通过云台补偿。 下面的动画说明了Osmo方向锁定。

![osmoLock](https://terra-1-g.djicdn.com/84f990b0bbd145e6a3930de0c55d3b2b/admin/doc/d1c7a77f-9286-4efa-ada4-94cf9ee4d689.gif)

### Endpoint

所有云台都有机械限位，但Ronin MX也可以具有逻辑限位（Endpoint），这些Endpoint在使用物理控制器时会限制其旋转。 Mobile SDK的API支持在**PitchUp**，**PitchDown**，**YawLeft **和**YawRight**的方向启用和设置Endpoint。

### 电机控制

对于可调节负载的云台，更精细的电机控制可用于补偿不同质量的负载。 控制器为比例积分微分（PID）类型，其系数均可调整。

* **刚度：** PID控制器的比例项
* **强度：** PID控制器积分项的系数
* **预控制：** PID控制器的导数项的系数
* **陀螺仪滤波：** 用于消噪输出的系数

### Range Extension

范围扩展：当设备处于极端的姿势时，某些云台会自动设置限位，以防止相机看到起落架。 对于某些应用程序，只要开发人员和用户了解这种情况，则可以使用MSDK范围扩展接口把限位取消。

<!--### 直立模式

M600允许将Ronin MX安装在飞机顶部而不是飞机下方。 在进行桥梁等结构下方的检查时，此功能特别有用。 Mobile SDK提供了可以设置云台直立模式的API。
-->

